zapper=crng_zapper
crng_www=crng_www
exploit_exec=exploit

obj-m+=$(zapper).o $(crng_www).o

CCFLAGS=-g
CFLAGS_crng_www.o := -O0

all: modules install $(exploit_exec)

modules:
	make -C /lib/modules/$(shell uname -r)/build/ M=$(PWD) modules V=1

$(exploit_exec): chacha_prng.c prng_exploit.c
	$(CC) $(CCFLAGS) $^ -o $@

install: modules
	sudo insmod $(zapper).ko
	sudo insmod $(crng_www).ko

clean:
	make -C /lib/modules/$(shell uname -r)/build/ M=$(PWD) clean
	rm -f $(exploit_exec)
	-sudo rmmod $(zapper) 
	-sudo rmmod $(crng_www)
